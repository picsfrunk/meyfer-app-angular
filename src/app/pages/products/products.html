<div class="product-list-container">
  <div class="search-bar" style="margin-bottom: 1rem;">
    <nz-input-group [nzSuffix]="suffixIcon">
      <input
        type="text"
        nz-input
        placeholder="Buscar productos..."
        [value]="searchTerm()"
        (input)="searchTerm.set($any($event.target).value); loadProducts()"
      />
    </nz-input-group>
    <ng-template #suffixIcon>
      <span nz-icon nzType="search"></span>
    </ng-template>
  </div>

  <nz-spin [nzSpinning]="isLoading()">
    <div class="product-grid">
      @for (product of displayProducts; track product.product_id) {

        <nz-card
          class="product-card"
          [nzCover]="coverTemplate"
          [nzActions]="[moreInfo, add]"
          nzSize="small"
        >
          <nz-card-meta (click)="openProductInfo(product)"
            nzTitle="{{ product.display_name }}"
            nzDescription="{{ product.list_price | currency: 'ARS' : 'symbol' }}"
          ></nz-card-meta>

        </nz-card>

        <ng-template #coverTemplate>
          <div class="product-image-container">

            <img
              nz-image
              [nzSrc]="product.image_url || 'assets/no-image.png'"
              [alt]="product.display_name"
              class="product-image"
              loading="lazy"
            />
          </div>
        </ng-template>

        <ng-template #add>
          <button nz-button nzType="primary" (click)="addToCart(product)">
            <nz-icon nzType="shopping-cart" nzTheme="outline" />
            Agregar
          </button>
        </ng-template>

        <ng-template #moreInfo>
          <button nz-button nzType="default" (click)="openProductInfo(product)">
            <nz-icon nzType="info-circle" nzTheme="outline" />
            Abrir
          </button>
        </ng-template>




      }
    </div>
  </nz-spin>

  <div class="pagination-container">
    <nz-pagination
      [nzPageIndex]="page()"
      [nzPageSize]="limit()"
      [nzTotal]="total"
      (nzPageIndexChange)="onPageIndexChange($event)"
    ></nz-pagination>
  </div>
</div>

<app-product-info #productInfoModal [onAddToCart]="addToCart.bind(this)"></app-product-info>
