<div class="product-list-container">
  <h1>Cat√°logo de Productos</h1>

  <div class="search-bar" style="margin-bottom: 1rem;">
    <nz-input-group [nzAddOnAfter]="searchButton">
      <input
        type="text"
        nz-input
        placeholder="Buscar productos..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="filterProducts()"
      />
    </nz-input-group>
    <ng-template #searchButton>
      <button
        nz-button
        nzType="primary"
        (click)="filterProducts()"
        [disabled]="!searchTerm.trim()"
      >
        <span nz-icon nzType="search"></span>
      </button>
    </ng-template>
  </div>

  <nz-spin [nzSpinning]="isLoading()">
    <div class="product-grid">
      @for (product of displayProducts; track product.product_id) {
        <nz-card class="product-card" [nzBordered]="true" [nzHoverable]="true">
          <nz-card-meta
            [nzTitle]="product.display_name"
            [nzDescription]="'Unidad: ' + product.base_unit_name + ' - $' + (product.list_price | number:'1.0-2')"
          >
          </nz-card-meta>

          <img
            nz-card-cover
            [src]="product.image_url"
            [alt]="product.display_name"
            class="product-image"
            loading="lazy"
          />

          <div class="card-actions">
            <button nz-button nzType="primary" (click)="addToCart(product)">
              Agregar al carrito
            </button>
          </div>
        </nz-card>
      }
    </div>
  </nz-spin>

  <div class="pagination-container">
    <nz-pagination
      [nzPageIndex]="page"
      [nzPageSize]="limit"
      [nzTotal]="total"
      (nzPageIndexChange)="loadProducts($event)"
    ></nz-pagination>
  </div>
</div>
